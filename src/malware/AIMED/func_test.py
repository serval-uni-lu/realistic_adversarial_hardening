from subprocess import call, check_output, CalledProcessError, Popen, PIPE,run

import os
from shutil import which


def check_funcionality(path_to_sample):

	try:						
		status = check_output([ 'C:\Program Files\Oracle\VirtualBox\VBoxManage.exe', 'guestcontrol', 'sandbox', '--username', 'vagrant', '--password', 
		'vagrant', 'run', '--exe', path_to_sample], timeout=0.5,  cwd='C:\\Program Files\\Oracle\\VirtualBox')
		#status = run([ 'VBoxManage', 'guestcontrol', 'sandbox', '--username', 'vagrant', '--password', 
		#'#vagrant', 'run', '--exe', path_to_sample], timeout=0.5, shell=True, check=True,stdout=PIPE, cwd='C:\\Program Files\\Oracle\\VirtualBox').stdout		
	except Exception as err:
		print(err)
		if 'returned non-zero exit status 1.' in str(err): 
			print('\nMutation corrupt!\n')
			valid = False
		else:
			print('\nMutation WORKING!\n')
			valid = True
	try:
		status = check_output([ 'C:\Program Files\Oracle\VirtualBox\VBoxManage.exe', 'guestcontrol', 'sandbox', 'closesession', '--all'], timeout=1,  cwd='C:\\Program Files\\Oracle\\VirtualBox')
	except Exception as err:
		print("here")
		print(err)
	return valid







